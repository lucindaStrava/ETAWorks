{"paragraphs":[{"text":"import spark.implicits._\nimport org.apache.spark.sql.{DataFrame, SaveMode}\nimport org.apache.spark.sql.functions.{broadcast, col, sum}","user":"anonymous","dateUpdated":"2020-01-09T00:07:16+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import spark.implicits._\nimport org.apache.spark.sql.{DataFrame, SaveMode}\nimport org.apache.spark.sql.functions.{broadcast, col, sum}\n"}]},"apps":[],"jobName":"paragraph_1576860577954_1149136668","id":"20191125-201541_1488915145","dateCreated":"2019-12-20T16:49:37+0000","dateStarted":"2020-01-09T00:07:16+0000","dateFinished":"2020-01-09T00:07:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:141623"},{"text":"// join groundTruth, athleteFeature and edgeFeature, assemble as single feature vector\n\nval trainTruth = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruthTrain\")\nval validationTruth = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruthValidation\")\nval athleteDf = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/athleteFeatureV0.1/featureVector/datestr=2019-10-01\")\nval edgeDf = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/edgeFeature\")\n\ntrainTruth.printSchema\n\ntrainTruth.createOrReplaceTempView(\"train_truth\")\nvalidationTruth.createOrReplaceTempView(\"validation_truth\")\nathleteDf.createOrReplaceTempView(\"athlete\")\nedgeDf.createOrReplaceTempView(\"edge\")\n\n","user":"anonymous","dateUpdated":"2020-01-09T00:07:30+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"trainTruth: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 2 more fields]\nvalidationTruth: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 2 more fields]\nathleteDf: org.apache.spark.sql.DataFrame = [ATHLETE_ID: decimal(38,0), features: vector]\nedgeDf: org.apache.spark.sql.DataFrame = [edgeUID: bigint, features: vector]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- label: double (nullable = true)\n |-- is_best_effort: double (nullable = true)\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["true/jobs/job?id=0","true/jobs/job?id=1","true/jobs/job?id=2","true/jobs/job?id=3"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1576860577964_-70973763","id":"20191202-225957_1876532271","dateCreated":"2019-12-20T16:49:37+0000","dateStarted":"2020-01-09T00:07:30+0000","dateFinished":"2020-01-09T00:07:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:141624"},{"text":"\nval mySql = \"\"\"\nselect x.edgeUID, x.athleteId, x.label, x.is_best_effort,\nx.is_best_effort as best_effort,\nathlete.features as athleteFeature, edge.features as edgeFeature\nfrom train_truth x\njoin athlete\non bigint(athlete.ATHLETE_ID) = x.athleteId\njoin edge\non edge.edgeUID = x.edgeUID\n\n\"\"\"\n\n\nval trainingDf = spark.sql(mySql)\ntrainingDf.printSchema\n","user":"anonymous","dateUpdated":"2020-01-09T00:08:06+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mySql: String =\n\"\nselect x.edgeUID, x.athleteId, x.label, x.is_best_effort,\nx.is_best_effort as best_effort,\nathlete.features as athleteFeature, edge.features as edgeFeature\nfrom train_truth x\njoin athlete\non bigint(athlete.ATHLETE_ID) = x.athleteId\njoin edge\non edge.edgeUID = x.edgeUID\n\n\"\ntrainingDf: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 5 more fields]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- label: double (nullable = true)\n |-- is_best_effort: double (nullable = true)\n |-- best_effort: double (nullable = true)\n |-- athleteFeature: vector (nullable = true)\n |-- edgeFeature: vector (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1576860577965_-28367791","id":"20191205-205539_594798106","dateCreated":"2019-12-20T16:49:37+0000","dateStarted":"2020-01-09T00:08:06+0000","dateFinished":"2020-01-09T00:08:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:141625"},{"text":"val mySql = \"\"\"\nselect x.edgeUID, x.athleteId, x.label, x.is_best_effort,\nx.is_best_effort as best_effort,\n\nathlete.features as athleteFeature, edge.features as edgeFeature\nfrom validation_truth x\njoin athlete\non bigint(athlete.ATHLETE_ID) = x.athleteId\njoin edge\non edge.edgeUID = x.edgeUID\n\n\"\"\"\n\n\nval validationDf = spark.sql(mySql)\nvalidationDf.printSchema\n","user":"anonymous","dateUpdated":"2020-01-09T00:08:18+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mySql: String =\n\"\nselect x.edgeUID, x.athleteId, x.label, x.is_best_effort,\nx.is_best_effort as best_effort,\n\nathlete.features as athleteFeature, edge.features as edgeFeature\nfrom validation_truth x\njoin athlete\non bigint(athlete.ATHLETE_ID) = x.athleteId\njoin edge\non edge.edgeUID = x.edgeUID\n\n\"\nvalidationDf: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 5 more fields]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- label: double (nullable = true)\n |-- is_best_effort: double (nullable = true)\n |-- best_effort: double (nullable = true)\n |-- athleteFeature: vector (nullable = true)\n |-- edgeFeature: vector (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1577127938395_-1693401952","id":"20191223-190538_762789305","dateCreated":"2019-12-23T19:05:38+0000","dateStarted":"2020-01-09T00:08:18+0000","dateFinished":"2020-01-09T00:08:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:141626"},{"text":"\n\nimport org.apache.spark.ml.feature.{Bucketizer, Imputer, OneHotEncoderEstimator, StringIndexer, VectorAssembler}\nimport org.apache.spark.ml.linalg.{DenseVector, Vector, Vectors}\nimport org.apache.spark.sql.DataFrame\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types.{DecimalType, DoubleType, IntegerType, LongType}\n  def assembleFeature(x: DataFrame, featureCols: Array[String]): DataFrame = {\n    val assembler = new VectorAssembler()\n      .setInputCols(featureCols)\n      .setOutputCol(\"features\")\n\n    val output = assembler.transform(x)\n    output.drop(featureCols: _*)\n  }\n  \n\nval training = assembleFeature(trainingDf, Array(\"is_best_effort\", \"edgeFeature\", \"athleteFeature\"))\nval validation = assembleFeature(validationDf, Array(\"is_best_effort\", \"edgeFeature\", \"athleteFeature\"))\n  \nvalidation.printSchema","user":"anonymous","dateUpdated":"2020-01-09T00:08:22+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.ml.feature.{Bucketizer, Imputer, OneHotEncoderEstimator, StringIndexer, VectorAssembler}\nimport org.apache.spark.ml.linalg.{DenseVector, Vector, Vectors}\nimport org.apache.spark.sql.DataFrame\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types.{DecimalType, DoubleType, IntegerType, LongType}\nassembleFeature: (x: org.apache.spark.sql.DataFrame, featureCols: Array[String])org.apache.spark.sql.DataFrame\ntraining: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 3 more fields]\nvalidation: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 3 more fields]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- label: double (nullable = true)\n |-- best_effort: double (nullable = true)\n |-- features: vector (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1576861068303_1069608117","id":"20191220-165748_478834736","dateCreated":"2019-12-20T16:57:48+0000","dateStarted":"2020-01-09T00:08:22+0000","dateFinished":"2020-01-09T00:08:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:141627"},{"text":"training.repartition(10).write.mode(SaveMode.Overwrite).option(\"compression\", \"gzip\").\nparquet(s\"s3a://strava.scratch/gbm/bay-area/etaTrainingDataV0p3\")\n\nvalidation.repartition(1).write.mode(SaveMode.Overwrite).option(\"compression\", \"gzip\").\nparquet(s\"s3a://strava.scratch/gbm/bay-area/etaValidationDataV0p3\")","user":"anonymous","dateUpdated":"2020-01-09T00:08:26+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["true/jobs/job?id=4","true/jobs/job?id=18","true/jobs/job?id=18"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1576860577967_1389057319","id":"20191205-205850_746916298","dateCreated":"2019-12-20T16:49:37+0000","dateStarted":"2020-01-09T00:08:26+0000","dateFinished":"2020-01-09T00:20:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:141628"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1576879893068_-1383657736","id":"20191220-221133_426402929","dateCreated":"2019-12-20T22:11:33+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:141629"}],"name":"/lucindaz/groundTruthJoinV0p1","id":"2EXHB334S","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}