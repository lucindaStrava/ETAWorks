{"paragraphs":[{"text":"import spark.implicits._\nimport org.apache.spark.sql.{DataFrame, SaveMode}\nimport org.apache.spark.sql.functions.{broadcast, col, sum}","user":"anonymous","dateUpdated":"2019-12-23T18:58:37+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import spark.implicits._\nimport org.apache.spark.sql.{DataFrame, SaveMode}\nimport org.apache.spark.sql.functions.{broadcast, col, sum}\n"}]},"apps":[],"jobName":"paragraph_1577126386937_-1864697061","id":"20191125-201541_1488915145","dateCreated":"2019-12-23T18:39:46+0000","dateStarted":"2019-12-23T18:54:06+0000","dateFinished":"2019-12-23T18:54:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:138873"},{"text":"val trainTruth = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruthTrain\")\nval validationTruth = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruthValidation\")\n\ntrainTruth.printSchema\n\ntrainTruth.createOrReplaceTempView(\"train_truth\")\nvalidationTruth.createOrReplaceTempView(\"validation_truth\")\n","user":"anonymous","dateUpdated":"2019-12-23T19:02:31+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"trainTruth: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 2 more fields]\nvalicationTruth: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 2 more fields]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- label: double (nullable = true)\n |-- is_best_effort: double (nullable = true)\n\n<console>:22: error: not found: value validationTruth\n       validationTruth.createOrReplaceTempView(\"validation_truth\")\n       ^\n"}]},"apps":[],"jobName":"paragraph_1577126386950_-249368377","id":"20191202-214608_1212262592","dateCreated":"2019-12-23T18:39:46+0000","dateStarted":"2019-12-23T18:57:22+0000","dateFinished":"2019-12-23T18:57:23+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:138874"},{"text":"// join groundTruth, athleteFeature and edgeFeature, assemble as single feature vector\n// the final vector has 100 dimension, 1 for best-effor indicator, 70 for eadge and 29 for athlete \n// v(0) is boolean indicator for 'best effort' (1 for true), v(1-70) is edge feature, v(71, 99) is athlete feature\n\nval athleteDf = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/athleteFeatureArray\")\nval edgeDf = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/edgeFeatureArray\")\n\nathleteDf.createOrReplaceTempView(\"athlete\")\nedgeDf.createOrReplaceTempView(\"edge\")\n","user":"anonymous","dateUpdated":"2019-12-23T18:56:48+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"truthDf: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [edgeUID: bigint, athleteId: bigint ... 4 more fields]\nathleteDf: org.apache.spark.sql.DataFrame = [ATHLETE_ID: bigint, featuresArray: array<double>]\nedgeDf: org.apache.spark.sql.DataFrame = [edgeUID: bigint, featuresArray: array<double>]\n"}]},"apps":[],"jobName":"paragraph_1577126386952_1509026072","id":"20191202-225957_1876532271","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138875"},{"text":"\nval mySql = \"\"\"\nselect edgeUID, athleteId,label, is_best_effort,\nconcat(Array(is_best_effort), athlete.featuresArray, edge.featuresArray) as featuresArray\n\nfrom train_truth\njoin athlete\non athlete.ATHLETE_ID = train_truth.athleteId\njoin edge\non edge.edgeUID = train_truth.edgeUID\n\n\"\"\"\n\nval training = spark.sql(mySql)\ntraining.printSchema\ntraining.repartition(10).write.mode(SaveMode.Overwrite).option(\"compression\", \"gzip\").\nparquet(s\"s3a://strava.scratch/gbm/bay-area/etaTrainingDataV0\")\n\n\n","user":"anonymous","dateUpdated":"2019-12-23T19:00:19+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mySql: String =\n\"\nwith x as (\nselect edgeUID, athleteId, minTime as label, array(double(1.0)) as is_best_effort\nfrom truth\nunion\nselect edgeUID, athleteId, maxTime as label, array(double(0.0)) as is_best_effort\nfrom truth\n)\n\nselect\nx.edgeUID,\nx.athleteId,\nx.is_best_effort[0] as is_best_effort,\nconcat(is_best_effort, athlete.featuresArray, edge.featuresArray) as featuresArray,\nx.label\nfrom x\njoin athlete\non athlete.ATHLETE_ID = x.athleteId\njoin edge\non edge.edgeUID = x.edgeUID\n\n\"\nresult: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 3 more fields]\nroot\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- is_best_effort: double (nullable = true)\n |-- featuresArray: array (nullable = true)\n |    |-- element: double (containsNull = true)\n |-- label: double (nullable = true)\n\ntraining: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [edgeUID: bigint, athleteId: bigint ... 3 more fields]\nvalidation: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [edgeUID: bigint, athleteId: bigint ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1577126386955_1665973661","id":"20191205-205539_594798106","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138876"},{"text":"\nval mySql = \"\"\"\nselect edgeUID, athleteId,label, is_best_effort,\nconcat(Array(is_best_effort), athlete.featuresArray, edge.featuresArray) as featuresArray\n\nfrom validation_truth\njoin athlete\non athlete.ATHLETE_ID = validation_truth.athleteId\njoin edge\non edge.edgeUID = validation_truth.edgeUID\n\n\"\"\"\n\nval validation = spark.sql(mySql)\nvalidation.printSchema\n\nvalidation.repartition(1).write.mode(SaveMode.Overwrite).option(\"compression\", \"gzip\").\nparquet(s\"s3a://strava.scratch/gbm/bay-area/etaValidationDataV0\")","user":"anonymous","dateUpdated":"2019-12-23T19:00:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1577126386958_-1246924","id":"20191205-205850_746916298","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138877"},{"text":"// sanity check:\nval df = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruth\")\ndf.createOrReplaceTempView(\"truth\")\n\nspark.sql(\"select min(minTime),  max(minTime), min(maxTime), max(maxTime) from truth\").collect()\n\n","user":"anonymous","dateUpdated":"2019-12-23T18:39:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"df: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 4 more fields]\nres31: Array[org.apache.spark.sql.Row] = Array([1.0000006663442491,499.9997055425638,1.0000006663442491,499.9997055425638])\n"}]},"apps":[],"jobName":"paragraph_1577126386964_210639855","id":"20191206-002506_866063574","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138878"},{"text":"val df = spark.read.load(s\"s3a://strava.scratch/gbm/bay-area/etaGroundTruth\")\n","user":"anonymous","dateUpdated":"2019-12-23T18:39:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"df: org.apache.spark.sql.DataFrame = [edgeUID: bigint, athleteId: bigint ... 4 more fields]\n"}]},"apps":[],"jobName":"paragraph_1577126386967_109608576","id":"20191206-212510_1045903120","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138879"},{"text":"df.printSchema","user":"anonymous","dateUpdated":"2019-12-23T18:39:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- edgeUID: long (nullable = true)\n |-- athleteId: long (nullable = true)\n |-- maxTime: double (nullable = true)\n |-- minTime: double (nullable = true)\n |-- numTraversal: long (nullable = true)\n |-- key: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1577126386970_74745845","id":"20191223-183849_2066411411","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138880"},{"user":"anonymous","dateUpdated":"2019-12-23T18:39:46+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1577126386972_-1619687919","id":"20191223-183855_355496377","dateCreated":"2019-12-23T18:39:46+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138881"}],"name":"/lucindaz/groundTruthJoinV0","id":"2EVGWU9JF","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}